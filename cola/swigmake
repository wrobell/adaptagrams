
OSNAME:=$(shell uname -s | sed 's/_.*//')

ifeq ($(OSNAME),Darwin)
	JAVA_INCLUDE = -I/System/Library/Frameworks/JavaVM.framework/Headers
	LINK = g++ -dynamiclib -framework JavaVM -o libcolajni.dylib
else 
  # Some make versions say only one else per if statment.
  ifeq ($(OSNAME),Linux)
	JAVA_INCLUDE = -I/usr/lib/jvm/java-6-sun-1.6.0.06/include \
		       -I/usr/lib/jvm/java-6-sun-1.6.0.06/include/linux
	LINK = g++ -shared -o libcolajni.so
  else 
    ifeq ($(OSNAME),MINGW32)
	JAVA_INCLUDE = -I/d/Programme/Java/jdk1.6.0_13/include \
		       -I/d/Programme/Java/jdk1.6.0_13/include/win32
	LINK = g++ -Wl,--add-stdcall-alias -shared -o cola.dll
    endif
  endif
endif

all: cola.jnilib colajava.jar

swig-worked: clean cola.i
	mkdir -p colajava
	swig -c++ -java -package colajava -outdir colajava cola.i
	touch swig-worked

cola_wrap.o: swig-worked
	g++ -I. $(JAVA_INCLUDE) -c cola_wrap.cxx

cola.jnilib: cola_wrap.o
	$(LINK) cola_wrap.o libcola/libcola.a libtopology/libtopology.a libavoid/libavoid.a libvpsc/libvpsc.a

colajava.jar: colajava swig-worked
	jar -cf colajava.jar colajava

realclean: clean

clean: mostlyclean
	rm -f cola.jnilib

mostlyclean:
	rm -f swig-worked
	rm -f cola_wrap.o cola_wrap.cxx colajava.jar
	rm -rf colajava/*

.PHONY: all clean mostlyclean realclean
